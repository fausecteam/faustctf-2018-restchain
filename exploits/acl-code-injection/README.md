ACL Code Injection
==================

The ACL implementation does not properly sanitize input resulting in a code
injection vulnerability.

Bug
---

ACLs are dynamically generated and evaluated by Node.js. The function
`makeAclRequireSecret` does not properly sanitize the secret passed as
parameter, allowing the injection of arbitrary Javascript code that then gets
executed by Node.js.

Exploit
-------

Even though you have code execution, it's not trival to exfiltrate the flag as the service does not allow outgoing network communication. The only direct feedback channel transfers only a single bit of information at a time (allow/deny) plus maybe some timing information, so one could morse the flag this way. A more convenient way is to copy the flag to the data/public/ directory using the `restchain-persist` binary, which is the method employed by the this exploit.

Patch
-----

Just properly sanitize the input in `makeAclRequireSecret`, possibly by simply JSON-encoding it. However, this alone won't fully protect you as ACLs are stored as HMACed Javascript code, so any ACL objects containing exploit code obtained before the patch remain valid. This can be mitigated by changing the HMAC key or additional filtering when executing ACLs. One could also completely rewrite the ACL code and throw out Node.js alltogether, but this is a bit of work. Note that if one does not take special care when patching, ACLs in existing blocks containing flags are also invalidated.
